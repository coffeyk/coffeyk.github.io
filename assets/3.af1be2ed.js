(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{1288:function(t,e,s){"use strict";s.d(e,"a",(function(){return m}));var i=s(8),n=s(1287),r=s(0),o=s.n(r),a=s(1470),c=s(1243),d=s(37);function u(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function h(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?u(Object(s),!0).forEach((function(e){l(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):u(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function l(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class m extends o.a.Component{render(){const{targets:t,notes:e,data:s,onGoto:n,headerTitle:r}=this.props;return o.a.createElement(a.a,{compact:!0,unstackable:!0,celled:!0},o.a.createElement(a.a.Header,null,o.a.createElement(a.a.Row,null,o.a.createElement(a.a.HeaderCell,{collapsing:!0},o.a.createElement("strong",null,o.a.createElement(i.Trans,{id:"core.ui.rotation-table.header.time"}))),(t||[]).map((t,e)=>o.a.createElement(a.a.HeaderCell,{key:"target_header_".concat(e),textAlign:"center",collapsing:!0},o.a.createElement("strong",null,t.header))),o.a.createElement(a.a.HeaderCell,null,o.a.createElement("strong",null,r||o.a.createElement(i.Trans,{id:"core.ui.rotation-table.header.rotation"}))),(e||[]).map((t,e)=>o.a.createElement(a.a.HeaderCell,{key:"note_header_".concat(e),textAlign:"center",collapsing:!0},o.a.createElement("strong",null,t.header))))),o.a.createElement(a.a.Body,null,s.map(s=>o.a.createElement(m.Row,h({key:s.start,onGoto:n,targets:t||[],notes:e||[]},s)))))}}m.targetAccessorResolver=(t,e)=>"string"==typeof e.accessor&&null!=t.targetsData?t.targetsData[e.accessor]:"function"==typeof e.accessor?e.accessor(t):{actual:0,expected:0},m.notesAccessorResolver=(t,e)=>"string"==typeof e.accessor&&null!=t.notesMap?t.notesMap[e.accessor]:"function"==typeof e.accessor?e.accessor(t):null,m.TargetCell=t=>{let{actual:e,expected:s}=t;return o.a.createElement(a.a.Cell,{textAlign:"center",positive:void 0!==s&&e>=s,negative:void 0!==s&&e<s},e,"/",void 0===s?"-":s)},m.Row=t=>{let{onGoto:e,targets:s,notes:i,notesMap:r,start:u,end:l,targetsData:p,rotation:g}=t;return o.a.createElement(a.a.Row,null,o.a.createElement(a.a.Cell,{textAlign:"center"},o.a.createElement("span",{style:{marginRight:5}},Object(d.d)(u/1e3)),"function"==typeof e&&o.a.createElement(c.a,{circular:!0,compact:!0,size:"mini",icon:"time",onClick:()=>e(u,l)})),s.map(t=>m.targetAccessorResolver({start:u,end:l,targetsData:p,rotation:g},t)).map((t,e)=>o.a.createElement(m.TargetCell,h({key:"target_".concat(e)},t))),o.a.createElement(a.a.Cell,null,o.a.createElement(n.a,{events:g})),i.map(t=>m.notesAccessorResolver({start:u,end:l,targetsData:p,notesMap:r,rotation:g},t)).map((t,e)=>o.a.createElement(a.a.Cell,{key:"notes_".concat(e),textAlign:"center"},t)))}},1289:function(t,e,s){"use strict";var i=s(372),n=s(373);class r extends n.a{constructor(t,e){super(t),this.info=null,this.info=e}get name(){return this.info.name}get type(){return this.info.type}get guid(){return this.info.guid}get id(){return this.info.id}}s.d(e,"a",(function(){return o}));class o extends i.a{constructor(){super(...arguments),this._players={}}getEntities(){return this._players}getEntity(t){let e=this._players[t];if(!e){const s=this.parser.report.friendlies.find(e=>e.id===t);if(!s)return null;this._players[t]=e=new r(this.parser,s)}return e}get selected(){return this.getEntity(this.parser.player.id)}}o.handle="combatants"},1290:function(t,e,s){"use strict";s.d(e,"a",(function(){return b}));var i=s(218),n=s.n(i),r=s(49),o=s.n(r),a=s(15),c=s.n(a),d=s(367),u=s.n(d),h=s(23),l=s(80),m=s(0),p=s.n(m);function g(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function f(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class b extends h.c{constructor(){super(...arguments),this._cooldownGroups={},this._currentAction=null,this._cooldowns={},this._groups={},this._cooldownGroups=u()(this.data.actions,"cooldownGroup"),this._buildGroups(this.constructor.cooldownOrder),this.addHook("begincast",{by:"player"},this._onBeginCast),this.addHook("cast",{by:"player"},this._onCast),this.addHook("complete",this._onComplete)}_buildGroups(t){if(!t)return;return t.map((e,s)=>{const i=-(t.length-s);if("number"==typeof e){const t=this.data.getAction(e);return this._buildGroup({id:e,content:t&&t.name,order:i}),e}const n=this._buildGroup({id:e.name,content:e.name,order:i});return e.merge?e.actions.forEach(t=>{this._groups[t]=n}):n.nestedGroups=this._buildGroups(e.actions),e.name})}_buildGroup(t){const e=new l.c(function(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?g(Object(s),!0).forEach((function(e){f(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):g(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}({showNested:!1},t));return this.timeline.addGroup(e),this._groups[t.id]=e,e}_onBeginCast(t){const e=this.data.getAction(t.ability.guid);e&&null!=e.cooldown&&(this._currentAction=e,this.startCooldown(e.id),c()(e.cooldownGroup)||this.startCooldownGroup(e.id,e.cooldownGroup))}_onCast(t){const e=this.data.getAction(t.ability.guid);if(!e||null==e.cooldown)return;const s=this._currentAction&&this._currentAction.id===e.id;this._currentAction=null,s||(this.startCooldown(e.id),c()(e.cooldownGroup)||this.startCooldownGroup(e.id,e.cooldownGroup))}_onComplete(){Object.keys(this._cooldowns).forEach(t=>{this._addToTimeline(parseInt(t,10))})}_addToTimeline(t){const e=this._cooldowns[t];if(!e)return!1;e.current&&(e.history.push(e.current),e.current=null);const s=this.data.getAction(t);return!(!s||s.onGcd)&&(this._groups[t]||this._buildGroup({id:t,content:s.name,order:t}),e.history.forEach(e=>{e.shared||this._groups[t].addItem(new l.b({type:"background",start:e.timestamp-this.parser.fight.start_time,length:e.length,content:p.a.createElement("img",{src:s.icon,alt:s.name})}))}),!0)}getCooldown(t){return this._cooldowns[t]||{current:null,history:[]}}startCooldownGroup(t,e){o()(this._cooldownGroups,e,[]).map(t=>t.id).filter(e=>e!==t).forEach(t=>this.startCooldown(t,!0))}startCooldown(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this.data.getAction(t);if(!s)return;const i=this.getCooldown(t);if(i.current){const e=this.parser.currentTimestamp-this.parser.fight.start_time;i.current.timestamp<this.parser.fight.start_time&&i.current.length>e?this.resetCooldown(t):i.history.push(i.current)}i.current={timestamp:this.parser.currentTimestamp,length:1e3*s.cooldown,shared:e,invulnTime:0},this._cooldowns[t]=i}reduceCooldown(t,e){const s=this.getCooldown(t),i=this.parser.currentTimestamp;s.current&&s.current.timestamp+s.current.length<i&&(s.history.push(s.current),s.current=null),null!==s.current&&(s.current.length-=1e3*e,s.current.timestamp+s.current.length<i&&this.resetCooldown(t))}setInvulnTime(t){const e=this.getCooldown(t);let s=this.parser.fight.start_time,i={},n=!0;for(const t of e.history)n&&(s=t.timestamp+t.length,n=!1,i=t),i.invulnTime=this.downtime.getDowntime(s,t.timestamp),s=t.timestamp+t.length,i=t}resetCooldown(t){const e=this.getCooldown(t);null!==e.current&&(e.current.length=this.parser.currentTimestamp-e.current.timestamp,e.history.push(e.current),e.current=null)}getCooldownRemaining(t){const e=this.getCooldown(t).current;return e?e.length-(this.parser.currentTimestamp-e.timestamp):0}getTimeOnCooldown(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this.getCooldown(t),n=this.parser.currentTimestamp;return e?this.setInvulnTime(t):i.history.map(t=>{t.invulnTime=0}),i.history.reduce((t,e)=>t+this.getAdjustedTimeOnCooldown(e,n,s),i.current?this.getAdjustedTimeOnCooldown(i.current,n,s):0)}getAdjustedTimeOnCooldown(t,e,s){const i=e-t.timestamp,r=t.length+t.invulnTime+s;return n()(i,0,r)}get used(){return Object.keys(this._cooldowns)}}b.handle="cooldowns",b.dependencies=["data","downtime","timeline"],b.cooldownOrder=[]},1291:function(t,e,s){"use strict";s.d(e,"a",(function(){return d}));var i=s(125),n=s.n(i),r=s(0),o=s.n(r),a=s(369);const c={aspectRatio:3,scales:{xAxes:[{type:"time",time:{displayFormats:{minute:"m:ss",second:"m:ss",millisecond:"m:ss.SS"},tooltipFormat:"mm:ss.SSS"}}]}};class d extends r.PureComponent{render(){const t=n()({},c,this.props.options||{});return o.a.createElement(a.a,{data:this.props.data,options:t,width:t.aspectRatio,height:1})}}},1302:function(t,e,s){"use strict";s.d(e,"a",(function(){return v}));var i=s(365),n=s.n(i),r=s(2),o=s(8),a=s(17),c=s(1288),d=s(23),u=s(1304),h=s(1285),l=s(80),m=s(0),p=s.n(m),g=s(366);function f(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function b(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?f(Object(s),!0).forEach((function(e){w(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):f(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function w(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class y{constructor(t,e){this.rotation=[],this.data=t,this.start=e}get gcds(){return this.rotation.map(t=>this.data.getAction(t.ability.guid)).filter(t=>t&&t.onGcd).length}getActionCountByIds(t){return this.rotation.filter(e=>t.includes(e.ability.guid)).length}}class v extends d.c{constructor(){super(...arguments),this.buffWindows=[]}get activeBuffWindow(){const t=n()(this.buffWindows);if(t&&null==t.end)return t}init(){this.addHook("cast",{by:"player"},this.onCast),this.addHook("applybuff",{by:"player"},this.onApplyBuff),this.addHook("removebuff",{by:"player"},this.onRemoveBuff),this.addHook("complete",this.onComplete)}onCast(t){const e=this.data.getAction(t.ability.guid);e&&!e.autoAttack&&this.activeBuffWindow&&this.considerAction(e)&&this.activeBuffWindow.rotation.push(t)}considerAction(t){return!0}onApplyBuff(t){this.buffStatus&&t.ability.guid===this.buffStatus.id&&this.startNewBuffWindow(t.timestamp)}startNewBuffWindow(t){this.buffWindows.push(new y(this.data,t))}onRemoveBuff(t){this.buffStatus&&t.ability.guid===this.buffStatus.id&&this.activeBuffWindow&&(this.activeBuffWindow.end=t.timestamp)}getBaselineExpectedGCDs(t){return this.expectedGCDs?this.expectedGCDs.expectedPerWindow:0}changeExpectedGCDsClassLogic(t){return 0}reduceExpectedGCDsEndOfFight(t){if(this.buffStatus.duration){const e=1e3*this.buffStatus.duration,s=this.parser.fight.end_time-t.start;if(e>=s){const t=this.globalCooldown.getEstimate();return Math.ceil((e-s)/t)}}return 0}getBaselineExpectedTrackedAction(t,e){return e.expectedPerWindow||0}changeExpectedTrackedActionClassLogic(t,e){return 0}getBuffWindowExpectedGCDs(t){return this.getBaselineExpectedGCDs(t)+this.changeExpectedGCDsClassLogic(t)-this.reduceExpectedGCDsEndOfFight(t)}getBuffWindowRequiredGCDsUsed(t){if(!this.requiredGCDs)return 0;const e=this.requiredGCDs.actions.map(t=>t.id);return t.getActionCountByIds(e)}getBuffWindowExpectedTrackedActions(t,e){return this.getBaselineExpectedTrackedAction(t,e)+this.changeExpectedTrackedActionClassLogic(t,e)}getBuffWindowNotes(t){}onComplete(){if(this.expectedGCDs){const t=this.buffWindows.reduce((t,e)=>{const s=this.getBuffWindowExpectedGCDs(e);return t+Math.max(0,s-e.gcds)},0);this.suggestions.add(new h.c({icon:this.buffAction.icon,content:this.expectedGCDs.suggestionContent,tiers:this.expectedGCDs.severityTiers,value:t,why:p.a.createElement(o.Trans,{id:"core.buffwindow.suggestions.missedgcd.why",values:{0:this.buffAction.name,missedGCDs:t}})}))}if(this.requiredGCDs){const t=this.buffWindows.reduce((t,e)=>t+Math.max(0,e.gcds-this.getBuffWindowRequiredGCDsUsed(e)),0);this.suggestions.add(new h.c({icon:this.requiredGCDs.icon,content:this.requiredGCDs.suggestionContent,tiers:this.requiredGCDs.severityTiers,value:t,why:p.a.createElement(o.Trans,{id:"core.buffwindow.suggestions.badgcd.why",values:{0:this.buffAction.name,invalidGCDs:t}})}))}if(this.trackedActions){const t=this.trackedActions.actions.reduce((t,e)=>t+this.buffWindows.reduce((t,s)=>t+Math.max(0,e.expectedPerWindow-s.getActionCountByIds([e.action.id])),0),0);this.suggestions.add(new h.c({icon:this.trackedActions.icon,content:this.trackedActions.suggestionContent,tiers:this.trackedActions.severityTiers,value:t,why:p.a.createElement(o.Trans,{id:"core.buffwindow.suggestions.trackedaction.why",values:{0:this.buffAction.name,missedActions:t}})}))}if(this.trackedBadActions){const t=this.trackedBadActions.actions.reduce((t,e)=>t+this.buffWindows.reduce((t,s)=>t+Math.max(0,s.getActionCountByIds([e.action.id])-e.expectedPerWindow),0),0);this.suggestions.add(new h.c({icon:this.trackedBadActions.icon,content:this.trackedBadActions.suggestionContent,tiers:this.trackedBadActions.severityTiers,value:t,why:p.a.createElement(o.Trans,{id:"core.buffwindow.suggestions.trackedbadaction.why",values:{0:this.buffAction.name,badActions:t}})}))}}output(){const t=[],e=[];this.expectedGCDs&&t.push({header:p.a.createElement(o.Trans,{id:"core.buffwindow.table.header.gcds"}),accessor:"missedgcd"}),this.requiredGCDs&&t.push({header:p.a.createElement("img",{src:this.requiredGCDs.icon,alt:"",style:{height:"20px"}}),accessor:"badgcd"}),this.trackedActions&&this.trackedActions.actions.forEach(e=>{t.push({header:p.a.createElement(a.a,b({showName:!1},e.action)),accessor:e.action.name})}),this.rotationTableNotesColumnHeader&&e.push({header:this.rotationTableNotesColumnHeader,accessor:"notes"});const s=this.buffWindows.map(t=>{const e=t.start-this.parser.fight.start_time,s=(null!=t.end?t.end:t.start)-this.parser.fight.start_time,i={},n={};return this.expectedGCDs&&(i.missedgcd={actual:t.gcds,expected:this.getBuffWindowExpectedGCDs(t)}),this.requiredGCDs&&(i.badgcd={actual:this.getBuffWindowRequiredGCDsUsed(t),expected:this.getBuffWindowExpectedGCDs(t)}),this.trackedActions&&this.trackedActions.actions.forEach(e=>{i[e.action.name]={actual:t.getActionCountByIds([e.action.id]),expected:this.getBuffWindowExpectedTrackedActions(t,e)}}),this.rotationTableNotesColumnHeader&&(n.notes=this.getBuffWindowNotes(t)),{start:e,end:s,targetsData:i,rotation:t.rotation,notesMap:n}});return p.a.createElement(c.a,{targets:t,data:s,notes:e,onGoto:this.timeline.show,headerTitle:this.rotationTableHeader})}}v.handle="buffwindow",v.title={id:"core.buffwindow.title",defaults:"Buff Window"},Object(r.b)([d.d,Object(r.d)("design:type",g.a)],v.prototype,"data",void 0),Object(r.b)([d.d,Object(r.d)("design:type",h.d)],v.prototype,"suggestions",void 0),Object(r.b)([d.d,Object(r.d)("design:type",l.d)],v.prototype,"timeline",void 0),Object(r.b)([d.d,Object(r.d)("design:type",u.a)],v.prototype,"globalCooldown",void 0)},1304:function(t,e,s){"use strict";s.d(e,"a",(function(){return w}));var i=s(8),n=s(1295),r=s(0),o=s.n(r),a=s(23),c=s(80),d=s(370);function u(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function h(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?u(Object(s),!0).forEach((function(e){l(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):u(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function l(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const m=1500,p=2500,g=2500,f=100,b=!1;class w extends a.c{constructor(){super(...arguments),this._castingEvent=null,this._estimatedBaseGcd=null,this._estimateGcdCount=-1,this._lastGcd={isInstant:!1,event:null},this.gcds=[],this.gcdGroupId="gcd",this.addHook("complete",this._onComplete)}normalise(t){for(let e=0;e<t.length;e++){const s=t[e];if(!this.parser.byPlayer(s)||!s.ability)continue;const i=this.data.getAction(s.ability.guid);if(i&&i.onGcd)switch(s.type){case"begincast":this._castingEvent=s;break;case"cast":const t=null!==this._castingEvent&&this._castingEvent.ability.guid===i.id,e=t?this._castingEvent:s;this.saveGcd(h({},this._lastGcd),e.timestamp),this._lastGcd.isInstant=!t,this._lastGcd.event=e,this._castingEvent=null}}return t.length&&this.saveGcd(h({},this._lastGcd),t[t.length-1].timestamp),this._debugLogSavedGcds(),t}_debugLogSavedGcds(){b&&this.gcds.forEach(t=>{const e=this.parser.formatTimestamp(t.timestamp),s=this.data.getAction(t.actionId),i=t.isInstant?" Instant":"",n=t.casterTaxed?" CasterTaxed":"";console.log("".concat(e," ").concat(s.name,"[").concat(t.length,"|").concat(t.normalizedLength,"] Speedmod[").concat(t.speedMod,"]").concat(i).concat(n))})}_onComplete(){const t=this.parser.fight.start_time;this.timeline.addGroup(new c.a({id:this.gcdGroupId,content:"GCD",order:-99})),this.gcds.forEach(e=>{const s=this.data.getAction(e.actionId);s&&this.timeline.addItem(new c.b({type:"background",start:e.timestamp-t,length:this._getGcdLength(e),title:s.name,group:this.gcdGroupId,content:o.a.createElement("img",{src:s.icon,alt:s.name,title:s.name})}))});const e=this.getEstimate(!1);this.statistics.add(new d.b({title:o.a.createElement(i.Trans,{id:"core.gcd.estimated-gcd"}),icon:this.data.actions.ATTACK.icon,value:this.parser.formatDuration(e),info:o.a.createElement(i.Trans,{id:"core.gcd.no-statistics",components:[o.a.createElement("em",null),o.a.createElement("em",null)]})}))}saveGcd(t,e){if(!t.event)return;const s=this.data.getAction(t.event.ability.guid);if(!s||!s.id)return;let i=this.speedmod.get(t.event.timestamp),n=s.castTime;i<=.5&&(i/=.5,n*=.5);let r=!1,o=10*Math.round((e-t.event.timestamp)/10);!t.isInstant&&n>=s.cooldown&&(o-=f,r=!0);const a=null!=s.gcdRecast?s.gcdRecast:s.cooldown,c=t.isInstant||n<a?a:n,d=Math.round(o*(g/1e3/c)*(1/i));this.gcds.push({timestamp:t.event.timestamp,length:o,normalizedLength:d,speedMod:i,castTime:n,cooldown:a,casterTaxed:r,actionId:s.id,isInstant:t.isInstant})}getEstimate(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this.gcds.length;if(null===this._estimatedBaseGcd||e!==this._estimateGcdCount){const t=this.gcds.map(t=>t.normalizedLength);this._estimatedBaseGcd=t.length?n.a.mean(n.a.mode(t)):p,this._estimateGcdCount=e}return t&&(this._estimatedBaseGcd=Math.max(m,Math.min(p,this._estimatedBaseGcd))),this._estimatedBaseGcd}getUptime(){return this.gcds.reduce((t,e)=>{const s=this._getGcdLength(e);return t+s-this.downtime.getDowntime(e.timestamp,e.timestamp+s)},0)}_getGcdLength(t){let e=t.isInstant||t.castTime<=t.cooldown?t.cooldown:Math.max(t.castTime,t.cooldown);if(e*=1e3,e>m){const s=this.getEstimate()/p;e=Math.max(m,e*s*t.speedMod)}return Math.round(e+(t.casterTaxed?f:0))}}w.handle="gcd",w.dependencies=["precastAction","castTime","data","downtime","speedmod","statistics","timeline"],w.title={id:"core.gcd.title",defaults:"Global Cooldown"}},1311:function(t,e,s){var i=s(375),n=s(63),r=s(126),o=Math.max,a=Math.min;t.exports=function(t,e,s){var c=null==t?0:t.length;if(!c)return-1;var d=c-1;return void 0!==s&&(d=r(s),d=s<0?o(c+d,0):a(d,c-1)),i(t,n(e,3),d,!0)}},1332:function(t,e,s){"use strict";var i=s(1291),n=s(23),r=s(0),o=s.n(r),a=s(37),c=s(124),d=s.n(c);class u{constructor(t){this._parser=t.parser}get parser(){if(!this._parser)throw new Error("No parser found. Ensure this gauge is being passed to the core gauge module, or initialised with a reference to the parser.");return this._parser}setParser(t){this._parser=t}generateDataset(){}}function h(t){if(!t)throw new Error("Missing something required. Check the stack trace.");return t}class l extends u{constructor(t){super(t),this.minimum=0,this.history=[],this.onExpiration=()=>{this.expirationCallback&&this.expirationCallback()},this.maximum=t.maximum,this.expirationCallback=t.onExpiration,this.chartOptions=t.chart}get addTimestampHook(){return h(this._addTimestampHook)}get removeTimestampHook(){return h(this._removeTimestampHook)}get lastKnownState(){const{length:t}=this.history;if(0!==t)return this.history[t-1]}get remaining(){if(!this.lastKnownState)return this.minimum;if(this.lastKnownState.paused)return this.lastKnownState.remaining;const t=this.parser.currentTimestamp-this.lastKnownState.timestamp;return Math.max(this.minimum,this.lastKnownState.remaining-t)}get expired(){return this.remaining<=this.minimum}get paused(){return!!this.lastKnownState&&this.lastKnownState.paused}reset(){this.set(this.minimum)}start(){this.set(this.maximum)}refresh(){this.expired||this.start()}extend(t){this.expired||this.set(this.remaining+t)}pause(){this.set(this.remaining,!0)}resume(){this.set(this.remaining,!1)}set(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this.parser.currentTimestamp,i=Math.max(this.minimum,Math.min(t,this.maximum));this.history.push({timestamp:s,remaining:i,paused:e}),this.hook&&this.removeTimestampHook(this.hook),!e&&i>0&&(this.hook=this.addTimestampHook(s+i,this.onExpiration))}generateDataset(){if(!this.chartOptions)return;const t=this.parser.fight.start_time,e=this.parser.fight.end_time,s=[];this.history.forEach(i=>{const n=i.timestamp-t,{length:r}=s;if(r>0&&n<s[r-1].t){const t=s[r-1];t.y=(t.y||this.minimum/1e3)+(t.t-n)/1e3,t.t=n}else s.push({t:n});const o=(this.minimum+i.remaining)/1e3;if(i.paused||s.push({t:n,y:o}),!i.paused&&i.remaining>0){const r=Math.min(n+i.remaining,e-t),o=r-n;s.push({t:r,y:(this.minimum+i.remaining-o)/1e3})}});const{label:i,color:n}=this.chartOptions,r={label:i,data:s,lineTension:0};if(n){const t=d()(n);r.backgroundColor=t.fade(.8).toString(),r.borderColor=t.fade(.5).toString()}return r}setAddTimestampHook(t){this._addTimestampHook=t}setRemoveTimestampHook(t){this._removeTimestampHook=t}}class m extends n.c{constructor(){super(...arguments),this.gauges=[]}init(){this.addHook("death",{to:"player"},this.onDeath)}add(t){return t.setParser(this.parser),t instanceof l&&(t.setAddTimestampHook(this.addTimestampHook.bind(this)),t.setRemoveTimestampHook(this.removeTimestampHook.bind(this))),this.gauges.push(t),t}onDeath(t){this.gauges.forEach(t=>t.reset())}output(){const t=this.gauges.map(t=>t.generateDataset()).filter(a.g);if(t.length<1)return!1;const e={datasets:t};return o.a.createElement(i.a,{data:e})}}m.handle="gauge",m.title={id:"core.gauge.title",defaults:"Gauge"};var p=s(1444),g=s.n(p);class f extends u{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.overCap=0,this.history=[],this.minimum=t.minimum||0,this._value=t.initialValue||this.minimum,this.maximum=t.maximum||100,this.chartOptions=t.chart}get value(){return this._value}getValueAt(t){const e=g()(this.history,e=>e.timestamp<=t);return e?e.value:this.minimum}reset(){this.set(this.minimum)}modify(t){this.set(this._value+t)}set(t){this._value=Math.min(Math.max(t,this.minimum),this.maximum);const e=t-this._value;e>0&&(this.overCap+=e),this.pushHistory()}setMinimum(t){this.setBounds(t,this.maximum)}setMaximum(t){this.setBounds(this.minimum,t)}setBounds(t,e){this.minimum=t,this.maximum=e,this.set(this._value)}pushHistory(){const t=this.parser.currentTimestamp;t===(this.history.length?this.history[this.history.length-1].timestamp:NaN)&&this.history.pop(),this.history.push({timestamp:t,value:this._value,minimum:this.minimum,maximum:this.maximum})}generateDataset(){if(!this.chartOptions)return;const t=this.history.map(t=>({t:t.timestamp-this.parser.fight.start_time,y:t.value})),{label:e,color:s}=this.chartOptions,i={label:e,data:t,steppedLine:!0};if(s){const t=d()(s);i.backgroundColor=t.fade(.8).toString(),i.borderColor=t.fade(.5).toString()}return i}}s.d(e,"b",(function(){return m})),s.d(e,"a",(function(){return f})),s.d(e,"c",(function(){return l}))},1444:function(t,e,s){var i=s(688)(s(1311));t.exports=i}}]);
//# sourceMappingURL=3.af1be2ed.js.map