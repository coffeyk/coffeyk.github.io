(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{1288:function(t,e,a){"use strict";a.d(e,"a",(function(){return u}));var s=a(8),i=a(1287),r=a(0),n=a.n(r),o=a(1470),c=a(1243),l=a(37);function h(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?h(Object(a),!0).forEach((function(e){m(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function m(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class u extends n.a.Component{render(){const{targets:t,notes:e,data:a,onGoto:i,headerTitle:r}=this.props;return n.a.createElement(o.a,{compact:!0,unstackable:!0,celled:!0},n.a.createElement(o.a.Header,null,n.a.createElement(o.a.Row,null,n.a.createElement(o.a.HeaderCell,{collapsing:!0},n.a.createElement("strong",null,n.a.createElement(s.Trans,{id:"core.ui.rotation-table.header.time"}))),(t||[]).map((t,e)=>n.a.createElement(o.a.HeaderCell,{key:"target_header_".concat(e),textAlign:"center",collapsing:!0},n.a.createElement("strong",null,t.header))),n.a.createElement(o.a.HeaderCell,null,n.a.createElement("strong",null,r||n.a.createElement(s.Trans,{id:"core.ui.rotation-table.header.rotation"}))),(e||[]).map((t,e)=>n.a.createElement(o.a.HeaderCell,{key:"note_header_".concat(e),textAlign:"center",collapsing:!0},n.a.createElement("strong",null,t.header))))),n.a.createElement(o.a.Body,null,a.map(a=>n.a.createElement(u.Row,d({key:a.start,onGoto:i,targets:t||[],notes:e||[]},a)))))}}u.targetAccessorResolver=(t,e)=>"string"==typeof e.accessor&&null!=t.targetsData?t.targetsData[e.accessor]:"function"==typeof e.accessor?e.accessor(t):{actual:0,expected:0},u.notesAccessorResolver=(t,e)=>"string"==typeof e.accessor&&null!=t.notesMap?t.notesMap[e.accessor]:"function"==typeof e.accessor?e.accessor(t):null,u.TargetCell=t=>{let{actual:e,expected:a}=t;return n.a.createElement(o.a.Cell,{textAlign:"center",positive:void 0!==a&&e>=a,negative:void 0!==a&&e<a},e,"/",void 0===a?"-":a)},u.Row=t=>{let{onGoto:e,targets:a,notes:s,notesMap:r,start:h,end:m,targetsData:p,rotation:b}=t;return n.a.createElement(o.a.Row,null,n.a.createElement(o.a.Cell,{textAlign:"center"},n.a.createElement("span",{style:{marginRight:5}},Object(l.d)(h/1e3)),"function"==typeof e&&n.a.createElement(c.a,{circular:!0,compact:!0,size:"mini",icon:"time",onClick:()=>e(h,m)})),a.map(t=>u.targetAccessorResolver({start:h,end:m,targetsData:p,rotation:b},t)).map((t,e)=>n.a.createElement(u.TargetCell,d({key:"target_".concat(e)},t))),n.a.createElement(o.a.Cell,null,n.a.createElement(i.a,{events:b})),s.map(t=>u.notesAccessorResolver({start:h,end:m,targetsData:p,notesMap:r,rotation:b},t)).map((t,e)=>n.a.createElement(o.a.Cell,{key:"notes_".concat(e),textAlign:"center"},t)))}},1289:function(t,e,a){"use strict";var s=a(372),i=a(373);class r extends i.a{constructor(t,e){super(t),this.info=null,this.info=e}get name(){return this.info.name}get type(){return this.info.type}get guid(){return this.info.guid}get id(){return this.info.id}}a.d(e,"a",(function(){return n}));class n extends s.a{constructor(){super(...arguments),this._players={}}getEntities(){return this._players}getEntity(t){let e=this._players[t];if(!e){const a=this.parser.report.friendlies.find(e=>e.id===t);if(!a)return null;this._players[t]=e=new r(this.parser,a)}return e}get selected(){return this.getEntity(this.parser.player.id)}}n.handle="combatants"},1294:function(t,e,a){"use strict";a.d(e,"a",(function(){return E}));var s=a(8),i=a(0),r=a.n(i),n=a(1474),o=a(1287),c=a(51),l=a(23),h=a(1285),d=a(37);function m(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function u(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const p=2,b={0:2,1:1,2.5:0},g={1:h.a.MEDIUM,5:h.a.MAJOR};class E extends l.c{constructor(){super(...arguments),this._weaves=[],this._ongoingCastEvent=null,this._leadingGcdEvent=null,this._trailingGcdEvent=null,this._badWeaves=[],this.addHook("begincast",{by:"player"},this._onBeginCast),this.addHook("cast",{by:"player"},this._onCast),this.addHook("complete",this._onComplete)}_onBeginCast(t){this._ongoingCastEvent=t}_onCast(t){const e=this.data.getAction(t.ability.guid);e&&!e.autoAttack&&(this.isOgcd(e)?this._weaves.push(t):(this._ongoingCastEvent&&this._ongoingCastEvent.ability.guid===e.id?this._trailingGcdEvent=function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?m(Object(a),!0).forEach((function(e){u(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},t,{timestamp:this._ongoingCastEvent.timestamp}):this._trailingGcdEvent=t,this._ongoingCastEvent=null,this._saveIfBad(),this._leadingGcdEvent=this._trailingGcdEvent,this._weaves=[]))}_onComplete(){this._leadingGcdEvent&&this._saveIfBad();const t=this._badWeaves;this.suggestions.add(new h.c({icon:"https://xivapi.com/i/001000/001785.png",content:r.a.createElement(s.Trans,{id:"core.weaving.content",components:[r.a.createElement("a",{href:"javascript:void(0);",onClick:()=>this.parser.scrollTo(this.constructor.handle)}),r.a.createElement(c.a,{message:this.constructor.title})]}),why:r.a.createElement(s.Trans,{id:"core.weaving.why",values:{0:t.length}}),tiers:g,value:t.length}))}_saveIfBad(){const t=this._leadingGcdEvent||{timestamp:this.parser.fight.start_time},e=this._trailingGcdEvent.timestamp-t.timestamp-this.invuln.getUntargetableUptime("all",t.timestamp,this._trailingGcdEvent.timestamp),a={leadingGcdEvent:t,trailingGcdEvent:this._trailingGcdEvent,gcdTimeDiff:e,weaves:this._weaves};0!==a.weaves.length&&this.isBadWeave(a)&&this._badWeaves.push(a)}isOgcd(t){return!t.onGcd&&!t.autoAttack}isBadWeave(t,e){const a=t.weaves.filter(t=>!this.invuln.isUntargetable("all",t.timestamp)).length;if(!e)if(t.leadingGcdEvent.ability){const a=this.castTime.forEvent(t.leadingGcdEvent),s=Object(d.i)(b,a);e=void 0!==s?s:p}else e=p;const s=this.speedmod.get(this.parser.timestamp),i=this.gcd.getEstimate()*s;return t.gcdTimeDiff>i&&a>e}output(){const t=this._badWeaves;if(0===t.length)return!1;const e=t.map(t=>({key:t.leadingGcdEvent.timestamp,title:{content:r.a.createElement(r.a.Fragment,null,r.a.createElement("strong",null,this.parser.formatTimestamp(t.leadingGcdEvent.timestamp))," - ",r.a.createElement(s.Trans,{id:"core.weaving.panel-count",values:{0:t.weaves.length}})," (",this.parser.formatDuration(t.gcdTimeDiff)," ",r.a.createElement(s.Trans,{id:"core.weaving.between-gcds"}),")")},content:{content:r.a.createElement(o.a,{events:[...t.leadingGcdEvent.ability?[t.leadingGcdEvent]:[],...t.weaves]})}}));return r.a.createElement(n.a,{exclusive:!1,panels:e,styled:!0,fluid:!0})}}E.handle="weaving",E.dependencies=["castTime","data","gcd","invuln","speedmod","suggestions"],E.title={id:"core.weaving.title",defaults:"Weaving Issues"}},1459:function(t,e,a){"use strict";a.r(e);var s=a(8),i=a(0),r=a.n(i),n=a(17),o=a(14),c=a(23),l=a(1285);function h(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?h(Object(a),!0).forEach((function(e){m(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function m(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const u=["begincast","cast","damage","death"],p=Symbol("blmgauge"),b=3e4,g=15e3,E=3,_=3,y=3,I=2;class f extends c.c{constructor(){super(...arguments),this._astralFireStacks=0,this._umbralIceStacks=0,this._umbralHeartStacks=0,this._astralUmbralStackTimer=0,this._hasEnochian=!1,this._enochianTimer=0,this._enochianDownTimer={start:0,stop:0,time:0},this._polyglotStacks=0,this._droppedEnoTimestamps=[],this._lostPolyglot=0,this._overwrittenPolyglot=0,this._normalizeIndex=0,this._currentTimestamp=0,this._toAdd=[],this._lastAdded=null,this.addHook("complete",this._onComplete)}gaugeValuesChanged(t){return!t||(t.astralFire!==this._astralFireStacks||t.umbralIce!==this._umbralIceStacks||t.umbralHearts!==this._umbralHeartStacks||t.enochian!==this._hasEnochian||t.polyglot!==this._polyglotStacks)}addEvent(){const t=this._toAdd.length>0?this._toAdd[this._toAdd.length-1]:null;this.gaugeValuesChanged(t)&&(this._toAdd.push({type:p,timestamp:this._currentTimestamp,insertAfter:this._normalizeIndex,astralFire:this._astralFireStacks,umbralIce:this._umbralIceStacks,umbralHearts:this._umbralHeartStacks,enochian:this._hasEnochian,polyglot:this._polyglotStacks,lastGaugeEvent:this._lastAdded}),this._lastAdded=this._toAdd[this._toAdd.length-1])}normalise(t){for(this._currentTimestamp=t[0].timestamp,this.addEvent(),this._normalizeIndex=0;this._normalizeIndex<t.length;this._normalizeIndex++){const e=t[this._normalizeIndex];if(this._currentTimestamp=e.timestamp,this.updateStackTimers(e),u.includes(e.type)){if(this.parser.byPlayer(e))switch(e.type){case"begincast":break;case"cast":this._onCast(e)}"death"===e.type&&this.parser.toPlayer(e)&&this._onDeath(e)}}let e=0;return this._toAdd.sort((t,e)=>t.insertAfter-e.insertAfter).forEach(a=>{t.splice(a.insertAfter+1+e,0,a),e++}),t}onAstralUmbralTimeout(t){this._astralFireStacks=0,this._umbralIceStacks=0,this._astralUmbralStackTimer=0,this.onEnoDropped(t)}onEnoDropped(t){if(this._hasEnochian){this._enochianDownTimer.start=t.timestamp;const e=t.timestamp-this._enochianTimer;this._enochianDownTimer.time+=e,this._droppedEnoTimestamps.push(t.timestamp)}this._hasEnochian=!1,this._enochianTimer=0,this._umbralHeartStacks=0,this.addEvent()}onGainPolyglot(){this._polyglotStacks++,this._polyglotStacks>I&&this._overwrittenPolyglot++,this._polyglotStacks=Math.min(this._polyglotStacks,I),this.addEvent()}onConsumePolyglot(){!this._polyglotStacks>0&&this._overwrittenPolyglot>0&&this._overwrittenPolyglot--,this._polyglotStacks=Math.max(this._polyglotStacks-1,0),this.addEvent()}onGainAstralFireStacks(t,e){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._umbralIceStacks>0&&a?this.onAstralUmbralTimeout(t):(this._umbralIceStacks=0,this._astralUmbralStackTimer=t.timestamp,this._astralFireStacks=Math.min(this._astralFireStacks+e,E),this.addEvent())}onGainUmbralIceStacks(t,e){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._astralFireStacks>0&&a?this.onAstralUmbralTimeout(t):(this._astralFireStacks=0,this._astralUmbralStackTimer=t.timestamp,this._umbralIceStacks=Math.min(this._umbralIceStacks+e,E),this.addEvent())}onTransposeStacks(t){(this._astralFireStacks>0||this._umbralIceStacks>0)&&(this._astralUmbralStackTimer=t.timestamp,this._astralFireStacks>0?(this._astralFireStacks=0,this._umbralIceStacks=1):(this._astralFireStacks=1,this._umbralIceStacks=0),this.addEvent())}tryGainUmbralHearts(t,e){this._umbralIceStacks>0&&(this._umbralHeartStacks=Math.min(this._umbralHeartStacks+e,_),this.addEvent())}tryConsumeUmbralHearts(t,e){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._umbralHeartStacks>0&&(this._astralFireStacks>0||a)&&(this._umbralHeartStacks=Math.max(this._umbralHeartStacks-e,0),this.addEvent())}updateStackTimers(t){if((this._astralFireStacks>0||this._umbralIceStacks>0)&&t.timestamp-this._astralUmbralStackTimer>g&&this.onAstralUmbralTimeout(t),this._hasEnochian){const e=t.timestamp-this._enochianTimer;e>=b&&(this._enochianTimer=t.timestamp-(e-b),this.onGainPolyglot())}}_startEnoTimer(t){this._hasEnochian=!0,this._enochianTimer=t.timestamp,this._enochianDownTimer.start&&this._enoDownTimerStop(t)}_enoDownTimerStop(t){this._enochianDownTimer.stop=t.timestamp,this._enochianDownTimer.time+=Math.max(this._enochianDownTimer.stop-this._enochianDownTimer.start,0),this._enochianDownTimer.start=0,this._enochianDownTimer.stop=0}_countLostPolyglots(t){const e=this.unableToAct.getDowntimes().filter(t=>Math.max(0,t.end-t.start)>=g).reduce((t,e)=>t+Math.max(0,e.end-e.start),0);return Math.floor((t-e)/b)}_onCast(t){switch(t.ability.guid){case o.b.ENOCHIAN.id:this._astralFireStacks||this._umbralIceStacks||this.brokenLog.trigger(this,"no stack eno",r.a.createElement(s.Trans,{id:"blm.gauge.trigger.no-stack-eno",components:[r.a.createElement(n.a,d({},o.b.ENOCHIAN))]})),this._hasEnochian||(this._startEnoTimer(t),this.addEvent());break;case o.b.BLIZZARD_I.id:case o.b.BLIZZARD_II.id:case o.b.FREEZE.id:this.onGainUmbralIceStacks(t,E,!1),this.tryGainUmbralHearts(t,1);break;case o.b.BLIZZARD_III.id:this.onGainUmbralIceStacks(t,E,!1);break;case o.b.BLIZZARD_IV.id:this._hasEnochian||(this.brokenLog.trigger(this,"no eno b4",r.a.createElement(s.Trans,{id:"blm.gauge.trigger.no-eno-b4",components:[r.a.createElement(n.a,d({},o.b.BLIZZARD_IV)),r.a.createElement(n.a,d({},o.b.ENOCHIAN))]})),this._startEnoTimer(t)),this._umbralHeartStacks=_,this.addEvent();break;case o.b.UMBRAL_SOUL.id:this.onGainUmbralIceStacks(t,1),this.tryGainUmbralHearts(t,1);break;case o.b.FIRE_I.id:case o.b.FIRE_II.id:this.tryConsumeUmbralHearts(t,1),this.onGainAstralFireStacks(t,1);break;case o.b.FIRE_III.id:this.tryConsumeUmbralHearts(t,1),this.onGainAstralFireStacks(t,E,!1);break;case o.b.FIRE_IV.id:this._hasEnochian||(this.brokenLog.trigger(this,"no eno f4",r.a.createElement(s.Trans,{id:"blm.gauge.trigger.no-eno-f4",components:[r.a.createElement(n.a,d({},o.b.FIRE_IV)),r.a.createElement(n.a,d({},o.b.ENOCHIAN))]})),this._startEnoTimer(t)),this.tryConsumeUmbralHearts(t,1);break;case o.b.DESPAIR.id:this.onGainAstralFireStacks(t,E,!1);break;case o.b.FLARE.id:this.tryConsumeUmbralHearts(t,y,!0),this.onGainAstralFireStacks(t,E,!1);break;case o.b.XENOGLOSSY.id:case o.b.FOUL.id:this.onConsumePolyglot();break;case o.b.TRANSPOSE.id:this.onTransposeStacks(t)}}_onDeath(){this._astralFireStacks=0,this._umbralIceStacks=0,this._umbralHeartStacks=0,this._astralUmbralStackTimer=0,this._hasEnochian=!1,this._polyglotStacks=0,this._enochianTimer=0,this.addEvent()}_onComplete(t){this._enochianDownTimer.start&&this._enoDownTimerStop(t),this._lostPolyglot=this._countLostPolyglots(this._enochianDownTimer.time);const e=this._droppedEnoTimestamps.filter(t=>0===this.unableToAct.getDowntimes(t,t).filter(t=>Math.max(0,t.end-t.start)>=g).length).length;e&&this.suggestions.add(new l.b({icon:o.b.ENOCHIAN.icon,content:r.a.createElement(s.Trans,{id:"blm.gauge.suggestions.dropped-enochian.content",components:[r.a.createElement(n.a,d({},o.b.ENOCHIAN)),r.a.createElement(n.a,d({},o.b.XENOGLOSSY)),r.a.createElement(n.a,d({},o.b.FOUL)),r.a.createElement(n.a,d({},o.b.ENOCHIAN)),r.a.createElement(n.a,d({},o.b.FIRE_IV)),r.a.createElement(n.a,d({},o.b.BLIZZARD_IV)),r.a.createElement(n.a,d({},o.b.ENOCHIAN))]}),severity:l.a.MEDIUM,why:r.a.createElement(s.Trans,{id:"blm.gauge.suggestions.dropped-enochian.why",values:{droppedEno:e}})})),this._lostPolyglot&&this.suggestions.add(new l.b({icon:o.b.XENOGLOSSY.icon,content:r.a.createElement(s.Trans,{id:"blm.gauge.suggestions.lost-polyglot.content",components:[r.a.createElement(n.a,d({},o.b.ENOCHIAN)),r.a.createElement(n.a,d({},o.b.XENOGLOSSY)),r.a.createElement(n.a,d({},o.b.FOUL))]}),severity:l.a.MAJOR,why:r.a.createElement(s.Trans,{id:"blm.gauge.suggestions.lost-polyglot.why",values:{0:this._lostPolyglot}})})),this._overwrittenPolyglot&&this.suggestions.add(new l.b({icon:o.b.XENOGLOSSY.icon,content:r.a.createElement(s.Trans,{id:"blm.gauge.suggestions.overwritten-polyglot.content",components:[r.a.createElement(n.a,d({},o.b.XENOGLOSSY)),r.a.createElement(n.a,d({},o.b.FOUL)),r.a.createElement(n.a,d({},o.b.XENOGLOSSY)),r.a.createElement(n.a,d({},o.b.FOUL))]}),severity:l.a.MAJOR,why:r.a.createElement(s.Trans,{id:"blm.gauge.suggestions.overwritten-polyglot.why",values:{0:this._overwrittenPolyglot}})}))}}f.handle="gauge",f.title={id:"blm.gauge.title",defaults:"Gauge"},f.dependencies=["precastAction","suggestions","brokenLog","unableToAct"];var S=a(55),w=a(61),O=a(80);function T(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function R(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?T(Object(a),!0).forEach((function(e){v(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function v(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const D=[o.b.THUNDER.id,o.b.THUNDER_II.id,o.b.THUNDER_III.id,o.b.THUNDER_IV.id],A=[w.b.THUNDERCLOUD.id,w.b.FIRESTARTER.id],C={[w.b.THUNDERCLOUD.id]:1e3*w.b.THUNDERCLOUD.duration,[w.b.FIRESTARTER.id]:1e3*w.b.FIRESTARTER.duration},F={[o.b.FIRE_III.id]:o.b.FIRE_III_PROC,[o.b.THUNDER_III.id]:o.b.THUNDER_III_PROC,[o.b.THUNDER_IV.id]:o.b.THUNDER_IV_PROC};class k extends c.c{constructor(){super(...arguments),this._castingSpellId=null,this._buffWindows={[w.b.THUNDERCLOUD.id]:{current:null,history:[]},[w.b.FIRESTARTER.id]:{current:null,history:[]}},this._droppedProcs={[w.b.THUNDERCLOUD.id]:0,[w.b.FIRESTARTER.id]:0},this._group=null,this.addHook("removebuff",{by:"player",abilityId:A},this._onLoseProc),this.addHook("applybuff",{by:"player",abilityId:A},this._onGainProc),this.addHook("refreshbuff",{by:"player",abilityId:A},this._onRefreshProc),this.addHook("begincast",{by:"player"},this._onBeginCast),this.addHook("cast",{by:"player"},this._onCast),this.addHook("death",{to:"player"},this._onDeath),this.addHook("complete",this._onComplete),this._group=new O.a({id:"procbuffs",content:"Procs",order:0,nestedGroups:[]}),this.timeline.addGroup(this._group)}getGroupIdForStatus(t){const e="procbuffs-"+t.id;return this._group.nestedGroups.includes(e)||(this.timeline.addGroup(new O.a({id:e,content:t.name})),this._group.nestedGroups.push(e)),e}_onLoseProc(t){this._stopAndSave(t.ability.guid,t.timestamp)}_onGainProc(t){const e=t.ability.guid;this._buffWindows[e].current={start:t.timestamp}}_onRefreshProc(t){this._stopAndSave(t.ability.guid,t.timestamp),this._onGainProc(t)}_onBeginCast(t){this._castingSpellId=t.ability.guid}_onCast(t){const e=t.ability.guid,a=Object(S.a)(o.b,"id",e);!a||!a.onGcd||this._castingSpellId&&this._castingSpellId===e||this._tryConsumeProc(t),this._castingSpellId=null}_tryConsumeProc(t){const e=t.ability.guid,a=this._getAffectingProcId(e);a&&this._buffWindows[a].current&&(this.castTime.set([e],0,t.timestamp,t.timestamp),F[e]&&(t.ability.overrideAction=F[e]),this._stopAndSave(a,t.timestamp,!1))}_getAffectingProcId(t){return D.includes(t)?w.b.THUNDERCLOUD.id:t===o.b.FIRE_III.id?w.b.FIRESTARTER.id:null}_onDeath(t){this._stopAndSave(w.b.THUNDERCLOUD.id,t.timestamp),this._stopAndSave(w.b.FIRESTARTER.id,t.timestamp)}_stopAndSave(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.parser.currentTimestamp,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=this._buffWindows[t];s.current&&(s.current.stop=e,s.current.stop-s.current.start>=C[t]&&a&&this._droppedProcs[t]++,s.history.push(s.current),s.current=null)}_onComplete(){A.forEach(t=>{const e=Object(S.a)(w.b,"id",t),a=this.getGroupIdForStatus(e),s=this.parser.fight.start_time;this._buffWindows[t].current&&this._stopAndSave(t),this._buffWindows[t].history.forEach(t=>{this.timeline.addItem(new O.b({type:"background",start:t.start-s,end:t.stop-s,group:a,content:r.a.createElement("img",{src:e.icon,alt:e.name})}))})}),this._droppedProcs[w.b.THUNDERCLOUD.id]&&this.suggestions.add(new l.b({icon:o.b.THUNDER_III_PROC.icon,content:r.a.createElement(s.Trans,{id:"blm.procs.suggestions.dropped-t3ps.content",components:[r.a.createElement(n.a,R({},o.b.THUNDER_III)),r.a.createElement(n.d,R({},w.b.THUNDERCLOUD))]}),severity:l.a.MEDIUM,why:r.a.createElement(s.Trans,{id:"blm.procs.suggestions.dropped-t3ps.why",values:{0:this._droppedProcs[w.b.THUNDERCLOUD.id]}})})),this._droppedProcs[w.b.FIRESTARTER.id]&&this.suggestions.add(new l.b({icon:o.b.FIRE_III_PROC.icon,content:r.a.createElement(s.Trans,{id:"blm.procs.suggestions.dropped-f3ps.content",components:[r.a.createElement(n.a,R({},o.b.FIRE_III)),r.a.createElement(n.d,R({},w.b.FIRESTARTER))]}),severity:l.a.MEDIUM,why:r.a.createElement(s.Trans,{id:"blm.procs.suggestions.dropped-f3ps.why",values:{0:this._droppedProcs[w.b.FIRESTARTER.id]}})}))}}k.handle="procs",k.dependencies=["castTime","timeline","suggestions"];var P=a(1294),H=1,N=2,j=3,U=4;const L=[o.b.LUCID_DREAMING.id,o.b.ADDLE.id,o.b.SURECAST.id,o.b.TRANSPOSE.id],G=1e4,M=3;class x extends P.a{constructor(){super(...arguments),this._astralFireStacks=0,this._umbralIceStacks=0,this._lastF3FastCast=!1,this._lastB3FastCast=!1,this._ctIndex=null,this.addHook(p,this._onGaugeChange),this.addHook("begincast",{by:"player",abilityId:o.b.FIRE_III.id},this._beginFire3),this.addHook("begincast",{by:"player",abilityId:o.b.BLIZZARD_III.id},this._beginBlizzard3),this.addHook("applybuff",{by:"player",abilityId:w.b.TRIPLECAST.id},this._onApplyTriple),this.addHook("removebuff",{by:"player",abilityId:w.b.TRIPLECAST.id},this._onRemoveTriple)}_beginFire3(){this._lastF3FastCast=this._umbralIceStacks===M}_beginBlizzard3(){this._lastB3FastCast=this._astralFireStacks===M}_onGaugeChange(t){this._astralFireStacks=t.astralFire,this._umbralIceStacks=t.umbralIce}_onApplyTriple(){this._ctIndex=this.castTime.set("all",0)}_onRemoveTriple(){this.castTime.reset(this._ctIndex)}isBadWeave(t,e){if(t.leadingGcdEvent.ability){const e=t.weaves.filter(t=>!this.invuln.isUntargetable("all",t.timestamp)).length;if(1===e&&L.includes(t.weaves[0].ability.guid))return!1;if(1===e){if(t.weaves[0].timestamp-this.parser.fight.start_time<G&&t.weaves[0].ability.guid===o.b.ENOCHIAN.id)return!1}if((t.leadingGcdEvent.ability.guid===o.b.FIRE_III.id&&this._lastF3FastCast||t.leadingGcdEvent.ability.guid===o.b.BLIZZARD_III.id&&this._lastB3FastCast)&&1===e)return!1}return super.isBadWeave(t,e)}}x.handle="weaving",x.displayOrder=U,x.dependencies=[...P.a.dependencies,"invuln","gauge","castTime"];var W=a(2),B=a(1281),Z=a(93),V=a(1288),Y=a(1286),z=a(1289),J=a(376),X=a(371),q=a(383);const K=[o.b.FIRE_I.id,o.b.FIRE_II.id,o.b.FIRE_III.id,o.b.FIRE_IV.id,o.b.FLARE.id,o.b.DESPAIR.id],Q=[o.b.BLIZZARD_I.id,o.b.BLIZZARD_II.id,o.b.BLIZZARD_III.id,o.b.BLIZZARD_IV.id,o.b.FREEZE.id,o.b.UMBRAL_SOUL.id];function $(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function tt(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?$(Object(a),!0).forEach((function(e){et(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):$(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function et(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const at=!1,st=6,it=5,rt=1,nt=9600,ot=18e3,ct=15e3,lt=3,ht={1:l.a.MINOR,3:l.a.MEDIUM,5:l.a.MAJOR},dt=[o.b.BLIZZARD_III.id,o.b.TRANSPOSE.id,o.b.FREEZE.id],mt=3,ut={NONE:{priority:0,message:"No errors"},FINAL_OR_DOWNTIME:{priority:1,message:"Ended with downtime, or last cycle"},SHORT:{priority:2,message:"Too short, won't process"},MISSING_FIRE4S:{priority:10,message:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.error-messages.missing-fire4s",components:[r.a.createElement(n.a,tt({},o.b.FIRE_IV))]})},MISSING_DESPAIRS:{priority:15,message:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.error-messages.missing-despair",components:[r.a.createElement(n.a,tt({},o.b.DESPAIR))]})},MANAFONT_BEFORE_DESPAIR:{priority:30,message:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.error-messages.manafont-before-despair",components:[r.a.createElement(n.a,tt({},o.b.MANAFONT)),r.a.createElement(n.a,tt({},o.b.DESPAIR))]})},EXTRA_T3:{priority:49,message:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.error-messages.extra-t3",components:[r.a.createElement(n.a,tt({},o.b.THUNDER_III))]})},EXTRA_F1:{priority:50,message:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.error-messages.extra-f1",components:[r.a.createElement(n.a,tt({},o.b.FIRE_I))]})},NO_FIRE_SPELLS:{priority:75,message:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.error-messages.no-fire-spells"})},DROPPED_ENOCHIAN:{priority:100,message:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.error-messages.dropped-enochian",components:[r.a.createElement(n.a,tt({},o.b.ENOCHIAN))]})},DIED:{priority:101,message:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.error-messages.died",components:[r.a.createElement(n.a,tt({showName:!1},o.b.RAISE))]})}};class pt{constructor(t,e){this.casts=[],this.hasManafont=!1,this.inFirePhase=!1,this.atypicalAFStart=!1,this.firePhaseStartMP=0,this.finalOrDowntime=!1,this.gaugeStateBeforeFire=new bt,this._errorCode=ut.NONE,this.startTime=t,this.gaugeStateBeforeFire=Object.assign(this.gaugeStateBeforeFire,e)}set errorCode(t){t.priority>this._errorCode.priority&&(this._errorCode=t)}get errorCode(){return this._errorCode}get expectedFire4s(){if(this.finalOrDowntime)return;let t=0===this.gaugeStateBeforeFire.umbralHearts&&0===this.casts.filter(t=>t.ability.guid===o.b.FIRE_I.id).length?it:st;return t+=this.hasManafont?rt:0,t}get actualFire4s(){return this.casts.filter(t=>t.ability.guid===o.b.FIRE_IV.id).length}get missingFire4s(){if(this.expectedFire4s)return Math.max(this.expectedFire4s-this.actualFire4s,0)}get expectedDespairs(){return this.hasManafont?2:1}get actualDespairs(){return this.casts.filter(t=>t.ability.guid===o.b.DESPAIR.id).length}get missingDespairs(){return Math.max(this.expectedDespairs-this.actualDespairs,0)}overrideErrorCode(t){this._errorCode=t}}class bt{constructor(){this.astralFire=0,this.umbralIce=0,this.umbralHearts=0,this.enochian=!1}}class gt extends c.c{constructor(){super(...arguments),this.currentGaugeState=new bt,this.currentRotation=new pt(this.parser.fight.start_time,this.currentGaugeState),this.history=[],this.firstEvent=!0,this.missedF4s=0,this.extraF1s=0,this.extraT3s=0,this.rotationsWithoutFire=0,this.manafontBeforeDespair=0,this.astralFiresMissingDespairs=0,this.thunder3Casts=0}init(){this.addHook("cast",{by:"player"},this.onCast),this.addHook("complete",this.onComplete),this.addHook(p,this.onGaugeEvent),this.addHook("death",{to:"player"},this.onDeath)}onGaugeEvent(t){0===this.currentGaugeState.astralFire&&t.astralFire>0&&(this.currentRotation.inFirePhase=!0,this.currentRotation.firePhaseStartMP=this.combatants.selected.resources.mp,this.currentRotation.gaugeStateBeforeFire.umbralIce===lt&&this.currentRotation.gaugeStateBeforeFire.umbralHearts===lt||(this.currentRotation.atypicalAFStart=!0)),this.currentGaugeState.enochian&&!t.enochian&&(this.currentRotation.errorCode=ut.DROPPED_ENOCHIAN),this.currentGaugeState.astralFire=t.astralFire,this.currentGaugeState.umbralIce=t.umbralIce,this.currentGaugeState.umbralHearts=t.umbralHearts,this.currentGaugeState.enochian=t.enochian,this.currentRotation.inFirePhase||(this.currentRotation.gaugeStateBeforeFire=Object.assign(this.currentRotation.gaugeStateBeforeFire,this.currentGaugeState))}onCast(t){const e=t.ability.guid;!this.primaryTargetId&&t.targetID&&(this.primaryTargetId=t.targetID),!dt.includes(e)||this.firstEvent||e===o.b.TRANSPOSE.id&&this.currentGaugeState.umbralIce>0||this.startRecording(t);const a=Object(S.a)(o.b,"id",e);a&&!a.autoAttack&&(this.firstEvent&&a.onGcd&&(this.firstEvent=!1),this.currentRotation.casts.push(t),e===o.b.MANAFONT.id&&(this.currentRotation.hasManafont=!0),e===o.b.THUNDER_III.id&&t.targetID===this.primaryTargetId&&this.thunder3Casts++)}onDeath(){this.currentRotation.errorCode=ut.DIED}getThunderUptime(){return this.enemies.getStatusUptime(w.b.THUNDER_III.id)/(this.parser.fightDuration-this.invuln.getInvulnerableUptime())*100}onComplete(){this.stopRecording(void 0),this.history.filter(t=>t.errorCode===ut.DROPPED_ENOCHIAN).forEach(t=>{this.unableToAct.getDowntimes(t.startTime,t.endTime).filter(t=>Math.max(0,t.end-t.start)>=ct).length>0&&t.overrideErrorCode(ut.FINAL_OR_DOWNTIME)}),this.missedF4s&&this.suggestions.add(new l.b({icon:o.b.FIRE_IV.icon,content:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.missed-f4s.content",components:[r.a.createElement(n.a,tt({},o.b.FIRE_IV)),r.a.createElement(n.a,tt({},o.b.BLIZZARD_IV))]}),severity:l.a.MEDIUM,why:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.missed-f4s.why",values:{0:this.missedF4s}})})),this.suggestions.add(new l.c({icon:o.b.FIRE_I.icon,content:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.extra-f1s.content",components:[r.a.createElement(n.a,tt({},o.b.FIRE_I))]}),tiers:ht,value:this.extraF1s,why:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.extra-f1s.why",values:{0:this.extraF1s}})})),this.suggestions.add(new l.c({icon:o.b.DESPAIR.icon,content:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.end-with-despair.content",components:[r.a.createElement(n.a,tt({},o.b.DESPAIR))]}),tiers:ht,value:this.astralFiresMissingDespairs,why:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.end-with-despair.why",values:{0:this.astralFiresMissingDespairs},components:[r.a.createElement(n.a,tt({showIcon:!1},o.b.DESPAIR))]})})),this.suggestions.add(new l.c({icon:o.b.MANAFONT.icon,content:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.mf-before-despair.content",components:[r.a.createElement(n.a,tt({},o.b.MANAFONT)),r.a.createElement(n.a,tt({},o.b.DESPAIR)),r.a.createElement(n.a,tt({showIcon:!1},o.b.DESPAIR)),r.a.createElement(n.a,tt({showIcon:!1},o.b.DESPAIR)),r.a.createElement(n.a,tt({},o.b.FIRE_IV))]}),tiers:{1:l.a.MINOR,2:l.a.MEDIUM,3:l.a.MAJOR},value:this.manafontBeforeDespair,why:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.mf-before-despair.why",values:{0:this.manafontBeforeDespair},components:[r.a.createElement(n.a,tt({},o.b.DESPAIR))]})})),this.suggestions.add(new l.c({icon:o.b.THUNDER_III_FALSE.icon,content:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.wrong-t3.content",components:[r.a.createElement(n.a,tt({},o.b.THUNDER_III)),r.a.createElement(n.a,tt({},o.b.FIRE_IV))]}),tiers:ht,value:this.extraT3s,why:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.wrong-t3.why",values:{0:this.extraT3s}})})),this.suggestions.add(new l.c({icon:o.b.BLIZZARD_II.icon,content:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.icemage.content",components:[r.a.createElement(n.a,tt({},o.b.FIRE_IV))]}),tiers:ht,value:this.rotationsWithoutFire,why:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.icemage.why",values:{0:this.rotationsWithoutFire}})}));const t=this.parser.fightDuration-this.invuln.getInvulnerableUptime(),e=Math.floor(t/ot);this.thunder3Casts>e&&this.suggestions.add(new l.b({icon:o.b.THUNDER_III.icon,content:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.excess-thunder.content",components:[r.a.createElement(n.a,tt({},o.b.THUNDER_III)),r.a.createElement(n.a,tt({},o.b.FIRE_IV)),r.a.createElement(n.a,tt({showIcon:!1},o.b.THUNDER_III)),r.a.createElement(n.d,tt({},w.b.THUNDER_III)),r.a.createElement(n.d,tt({},w.b.THUNDERCLOUD))]}),severity:this.thunder3Casts>2*e?l.a.MAJOR:l.a.MEDIUM,why:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.suggestions.excess-thunder.why",values:{0:this.thunder3Casts-e}})})),this.checklist.add(new Y.b({name:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.checklist.dots.name",components:[r.a.createElement(n.d,tt({},w.b.THUNDER_III))]}),description:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.checklist.dots.description",components:[r.a.createElement(n.d,tt({},w.b.THUNDER_III)),r.a.createElement(n.d,tt({},w.b.THUNDERCLOUD))]}),target:95,requirements:[new Y.a({name:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.checklist.dots.requirement.name",components:[r.a.createElement(n.d,tt({},w.b.THUNDER_III))]}),percent:()=>this.getThunderUptime()})]}))}startRecording(t){this.stopRecording(t),this.currentRotation=new pt(t.timestamp,this.currentGaugeState)}stopRecording(t){this.currentRotation.endTime=this.parser.currentTimestamp,(!t||t&&t.ability.guid===o.b.TRANSPOSE.id&&this.invuln.isUntargetable("all",t.timestamp))&&(this.currentRotation.finalOrDowntime=!0),this.processCycle(this.currentRotation),this.history.push(this.currentRotation)}processCycle(t){if(t.casts.length<=mt)return void(t.errorCode=ut.SHORT);t.missingDespairs&&(this.astralFiresMissingDespairs++,t.errorCode=ut.MISSING_DESPAIRS),t.hasManafont&&t.actualDespairs>0&&t.casts.findIndex(t=>t.ability.guid===o.b.MANAFONT.id)<t.casts.findIndex(t=>t.ability.guid===o.b.DESPAIR.id)&&(this.manafontBeforeDespair++,t.errorCode=ut.MANAFONT_BEFORE_DESPAIR);const e=t.casts.filter(t=>t.ability.guid===o.b.FIRE_I.id).length;e>1&&(t.errorCode=ut.EXTRA_F1,this.extraF1s+=Math.max(0,e-1)),t.finalOrDowntime?this.processDowntimeCycle(t):this.processNormalCycle(t)}processNormalCycle(t){const e=t.casts.filter(t=>t.ability.overrideAction).filter(t=>t.ability.overrideAction.id===o.b.THUNDER_III_FALSE.id).length;(e>1||e>0&&t.firePhaseStartMP<nt)&&(this.extraT3s++,t.errorCode=ut.EXTRA_T3),t.casts.filter(t=>K.includes(t.ability.guid)).length||(this.rotationsWithoutFire++,t.errorCode=ut.NO_FIRE_SPELLS),t.missingFire4s&&(t.errorCode=ut.MISSING_FIRE4S)}processDowntimeCycle(t){t.errorCode=ut.FINAL_OR_DOWNTIME,t.gaugeStateBeforeFire.umbralHearts>0&&2===t.missingFire4s&&this.missedF4s++}output(){const t=this.history.filter(t=>t.errorCode.priority>ut.SHORT.priority||at);if(t.length>0)return r.a.createElement(i.Fragment,null,r.a.createElement(B.a,null,r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.rotation-table.message",components:[r.a.createElement(n.a,tt({},o.b.FIRE_IV)),r.a.createElement(n.a,tt({},o.b.DESPAIR)),r.a.createElement(n.a,tt({},o.b.FIRE_IV)),r.a.createElement(n.a,tt({},o.b.DESPAIR)),r.a.createElement(n.a,tt({},o.b.MANAFONT)),r.a.createElement("br",null)]})),r.a.createElement(B.a,{warning:!0,icon:!0},r.a.createElement(Z.a,{name:"warning sign"}),r.a.createElement(B.a.Content,null,r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.rotation-table.disclaimer",components:[r.a.createElement("br",null)]}))),r.a.createElement(V.a,{targets:[{header:r.a.createElement(n.a,tt({showName:!1},o.b.FIRE_IV)),accessor:"fire4s"},{header:r.a.createElement(n.a,tt({showName:!1},o.b.DESPAIR)),accessor:"despairs"}],notes:[{header:r.a.createElement(s.Trans,{id:"blm.rotation-watchdog.rotation-table.header.reason"}),accessor:"reason"}],data:t.map(t=>({start:t.startTime-this.parser.fight.start_time,end:null!=t.endTime?t.endTime-this.parser.fight.start_time:t.startTime-this.parser.fight.start_time,targetsData:{fire4s:{actual:t.actualFire4s,expected:t.expectedFire4s},despairs:{actual:t.actualDespairs,expected:t.expectedDespairs}},notesMap:{reason:r.a.createElement(r.a.Fragment,null,t.errorCode.message)},rotation:t.casts})),onGoto:this.timeline.show}))}}gt.handle="RotationWatchdog",gt.title={id:"blm.rotation-watchdog.title",defaults:"Rotation Outliers"},gt.displayOrder=H,Object(W.b)([c.d,Object(W.d)("design:type",Y.e)],gt.prototype,"checklist",void 0),Object(W.b)([c.d,Object(W.d)("design:type",l.d)],gt.prototype,"suggestions",void 0),Object(W.b)([c.d,Object(W.d)("design:type",X.a)],gt.prototype,"invuln",void 0),Object(W.b)([c.d,Object(W.d)("design:type",J.a)],gt.prototype,"enemies",void 0),Object(W.b)([c.d,Object(W.d)("design:type",O.d)],gt.prototype,"timeline",void 0),Object(W.b)([c.d,Object(W.d)("design:type",z.a)],gt.prototype,"combatants",void 0),Object(W.b)([c.d,Object(W.d)("design:type",q.a)],gt.prototype,"unableToAct",void 0);var Et=a(1298);const _t=1250,yt=15e3,It=95;class ft extends Et.a{constructor(){super(...arguments),this.defaultAllowedAverageDowntimeDowntime=_t,this.defaultFirstUseOffset=yt,this.trackedCds=[{cooldowns:[o.b.LEY_LINES]},{cooldowns:[o.b.SHARPCAST]},{cooldowns:[o.b.MANAFONT],firstUseOffset:25e3},{cooldowns:[o.b.TRIPLECAST]}],this.checklistTarget=It,this.checklistDescription=r.a.createElement(s.Trans,{id:"blm.ogcd-downtime.ogcd-cd-metric",values:{ALLOWEDDOWNTIMEALL:_t}})}}var St=a(374);const wt=3,Ot=.5;class Tt extends St.a{constructor(){super(...arguments),this._astralFireStacks=0,this._umbralIceStacks=0,this._isFastCast=!1,this.SPEED_BUFF_STATUS_IDS.push(w.b.CIRCLE_OF_POWER.id)}jobSpecificNormaliseLogic(t){if([p,"begincast","cast"].includes(t.type))switch(t.type){case p:this._astralFireStacks=t.astralFire,this._umbralIceStacks=t.umbralIce;break;case"begincast":(this._umbralIceStacks===wt&&K.includes(t.ability.guid)||this._astralFireStacks===wt&&Q.includes(t.ability.guid))&&(this._isFastCast=!0,this.recalcSpeedmodAndSaveHistory(t));break;case"cast":this._isFastCast&&(this._isFastCast=!1,this.recalcSpeedmodAndSaveHistory(t))}}getJobAdditionalSpeedbuffScalar(){return this._isFastCast?Ot:1}}Tt.dependencies=[...St.a.dependencies,"gauge"];var Rt=a(1470),vt=a(1243);function Dt(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function At(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?Dt(Object(a),!0).forEach((function(e){Ct(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Dt(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function Ct(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const Ft=[w.b.LEY_LINES.id,w.b.CIRCLE_OF_POWER.id];class kt extends c.c{constructor(){super(...arguments),this._buffWindows={[w.b.LEY_LINES.id]:{current:null,history:[]},[w.b.CIRCLE_OF_POWER.id]:{current:null,history:[]}},this._group=null,this.addHook("applybuff",{by:"player",abilityId:Ft},this._onGain),this.addHook("removebuff",{by:"player",abilityId:Ft},this._onDrop),this.addHook("death",{to:"player"},this._onDeath),this.addHook("complete",this._onComplete),this._group=new O.a({id:"leybuffs",content:"Ley Lines Buffs",order:0,nestedGroups:[]}),this.timeline.addGroup(this._group)}_onGain(t){const e=Object(S.a)(w.b,"id",t.ability.guid);if(!e)return;this._buffWindows[e.id].current={start:t.timestamp};const a="leybuffs-"+e.id;this._group.nestedGroups.includes(a)||(this.timeline.addGroup(new O.a({id:a,content:e.name})),this._group.nestedGroups.push(a))}_onDrop(t){this._stopAndSave(t.ability.guid,t.timestamp)}_onDeath(t){this._stopAndSave(w.b.LEY_LINES.id,t.timestamp)}_stopAndSave(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.parser.currentTimestamp;const a=this._buffWindows[t];a.current&&(a.current.stop=e,a.history.push(a.current),a.current=null,t===w.b.LEY_LINES.id&&this._stopAndSave(w.b.CIRCLE_OF_POWER.id,e))}_dontMovePercent(t,e){return t/e*100}_onComplete(){this._buffWindows[w.b.LEY_LINES.id].current&&this._stopAndSave(w.b.LEY_LINES.id),Ft.forEach(t=>{const e=Object(S.a)(w.b,"id",t),a="leybuffs-"+e.id,s=this.parser.fight.start_time;this._buffWindows[t].history.forEach(t=>{this.timeline.addItem(new O.b({type:"background",start:t.start-s,end:t.stop-s,group:a,content:r.a.createElement("img",{src:e.icon,alt:e.name})}))})});const t=this._buffWindows[w.b.CIRCLE_OF_POWER.id].history.reduce((t,e)=>t+Math.max(e.stop-e.start,0),0),e=this._buffWindows[w.b.LEY_LINES.id].history.reduce((t,e)=>t+Math.max(e.stop-e.start,0),0);this.checklist.add(new Y.b({name:r.a.createElement(s.Trans,{id:"blm.leylines.checklist-caption"}),description:r.a.createElement(s.Trans,{id:"blm.leylines.checklist"}),requirements:[new Y.a({name:r.a.createElement(n.a,At({},o.b.LEY_LINES)),percent:this._dontMovePercent(t,e)})],target:90}))}output(){return r.a.createElement(Rt.a,{collapsing:!0,unstackable:!0,compact:"very"},r.a.createElement(Rt.a.Header,null,r.a.createElement(Rt.a.Row,null,r.a.createElement(Rt.a.HeaderCell,null,r.a.createElement(s.Trans,{id:"blm.leylines.timestamp-header"})),r.a.createElement(Rt.a.HeaderCell,null,r.a.createElement(s.Trans,{id:"blm.leylines.uptime-header"})),r.a.createElement(Rt.a.HeaderCell,null))),r.a.createElement(Rt.a.Body,null,this._buffWindows[w.b.LEY_LINES.id].history.map(t=>{const e=this._buffWindows[w.b.CIRCLE_OF_POWER.id].history.filter(e=>e.start>=t.start&e.stop<=t.stop).reduce((t,e)=>t+Math.max(e.stop-e.start,0),0),a=this._dontMovePercent(e,t.stop-t.start).toFixed(2);return r.a.createElement(Rt.a.Row,{key:t.start},r.a.createElement(Rt.a.Cell,null,this.parser.formatTimestamp(t.start)),r.a.createElement(Rt.a.Cell,null,a,"%"),r.a.createElement(Rt.a.Cell,null,r.a.createElement(vt.a,{onClick:()=>this.timeline.show(t.start-this.parser.fight.start_time,t.stop-this.parser.fight.start_time)},r.a.createElement(s.Trans,{id:"blm.leylines.timelinelink-button"}))))})))}}kt.handle="leylines",kt.title={id:"blm.leylines.title",defaults:"Ley Lines"},kt.displayOrder=j,kt.dependencies=["timeline","checklist"];const Pt=150,Ht=500;class Nt extends c.c{constructor(){super(...arguments),this._noCastWindows={current:null,history:[]},this._hardCast=!1,this.addHook("begincast",{by:"player"},this._onBegin),this.addHook("cast",{by:"player"},this._onCast),this.addHook("death",{to:"player"},this._onDeath),this.addHook("complete",this._onComplete)}_onCast(t){const e=this.gcd.getEstimate(!0);let a=t.timestamp;this._hardCast&&(a=t.timestamp+Ht,this._hardCast=!1),this._noCastWindows.current?(a-this._noCastWindows.current.start>e+Pt&&this._stopAndSave(a),this._noCastWindows.current={start:a}):this._noCastWindows.current={start:a}}_onBegin(t){const e=this.gcd.getEstimate(!0);this._noCastWindows.current&&(t.timestamp-this._noCastWindows.current.start>e+Pt&&this._stopAndSave(t.timestamp),this._noCastWindows.current=null,this._hardCast=!0)}_onDeath(){this._noCastWindows.current=null}_stopAndSave(t){const e=this._noCastWindows;e.current&&(e.current.stop=t,e.history.push(e.current),e.current=null)}_onComplete(t){const e=this.gcd.getEstimate(!0);this._stopAndSave(t.timestamp),this._noCastWindows.history=this._noCastWindows.history.filter(t=>0===this.invuln.getInvulns("all",t.start,t.stop).length),this._noCastWindows.history=this._noCastWindows.history.filter(t=>t.stop-t.start>e+Pt)}output(){const t=this.gcd.getEstimate(!0);if(0!==this._noCastWindows.history.length)return r.a.createElement(Rt.a,{collapsing:!0,unstackable:!0,compact:"very"},r.a.createElement(Rt.a.Header,null,r.a.createElement(Rt.a.Row,null,r.a.createElement(Rt.a.HeaderCell,null,r.a.createElement(s.Trans,{id:"blm.notcasting.timestamp-header"})),r.a.createElement(Rt.a.HeaderCell,null,r.a.createElement(s.Trans,{id:"blm.notcasting.duration-header"})),r.a.createElement(Rt.a.HeaderCell,null))),r.a.createElement(Rt.a.Body,null,this._noCastWindows.history.map(e=>r.a.createElement(Rt.a.Row,{key:e.start},r.a.createElement(Rt.a.Cell,null,this.parser.formatTimestamp(e.start)),r.a.createElement(Rt.a.Cell,null,"≥",this.parser.formatDuration(e.stop-e.start-t-Pt)),r.a.createElement(Rt.a.Cell,null,r.a.createElement(vt.a,{onClick:()=>this.timeline.show(e.start-this.parser.fight.start_time,e.stop-this.parser.fight.start_time)},r.a.createElement(s.Trans,{id:"blm.notcasting.timelinelink-button"})))))))}}function jt(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function Ut(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?jt(Object(a),!0).forEach((function(e){Lt(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):jt(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function Lt(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}Nt.handle="notcasting",Nt.title={id:"blm.notcasting.title",defaults:"Times you did literally nothing"},Nt.displayOrder=N,Nt.dependencies=["timeline","gcd","invuln"];const Gt=1e3*w.b.SHARPCAST.duration,Mt=[o.b.FIRE_I.id,o.b.THUNDER_III.id,o.b.THUNDER_IV.id,o.b.SCATHE.id];class xt extends c.c{constructor(){super(...arguments),this._buffWindows={current:null,history:[]},this._droppedSharpcasts=0,this._sharpedScathes=0,this.addHook("removebuff",{by:"player",abilityId:w.b.SHARPCAST.id},this._onRemoveSharpcast),this.addHook("applybuff",{by:"player",abilityId:w.b.SHARPCAST.id},this._onGainSharpcast),this.addHook("cast",{by:"player",abilityId:Mt},this._onCast),this.addHook("death",{to:"player"},this._onDeath),this.addHook("complete",this._onComplete)}_onRemoveSharpcast(t){this._stopAndSave(t.timestamp)}_onGainSharpcast(t){this._buffWindows.current={start:t.timestamp}}_onCast(t){const e=t.ability.guid,a=Object(S.a)(o.b,"id",e);a&&a.onGcd&&this._tryConsumeSharpcast(t)}_tryConsumeSharpcast(t){const e=t.ability.guid;Mt.includes(e)&&this._buffWindows.current&&(this._stopAndSave(t.timestamp,!1),e===o.b.SCATHE.id&&this._sharpedScathes++)}_onDeath(t){this._stopAndSave(t.timestamp)}_stopAndSave(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parser.currentTimestamp,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._buffWindows.current&&(this._buffWindows.current.stop=t,this._buffWindows.current.stop-this._buffWindows.current.start>=Gt&&e&&this._droppedSharpcasts++,this._buffWindows.history.push(this._buffWindows.current),this._buffWindows.current=null)}_onComplete(){this._buffWindows.current&&this._stopAndSave();const t=this.procs.getGroupIdForStatus(w.b.SHARPCAST),e=this.parser.fight.start_time;this._buffWindows.history.forEach(a=>{this.timeline.addItem(new O.b({type:"background",start:a.start-e,end:a.stop-e,group:t,content:r.a.createElement("img",{src:w.b.SHARPCAST.icon,alt:w.b.SHARPCAST.name})}))}),this.suggestions.add(new l.c({icon:w.b.SHARPCAST.icon,content:r.a.createElement(s.Trans,{id:"blm.sharpcast.suggestions.dropped-sharpcasts.content",components:[r.a.createElement(n.d,Ut({},w.b.THUNDERCLOUD)),r.a.createElement(n.d,Ut({},w.b.FIRESTARTER)),r.a.createElement(n.d,Ut({},w.b.SHARPCAST))]}),tiers:{1:l.a.MINOR,3:l.a.MEDIUM,5:l.a.MAJOR},value:this._droppedSharpcasts,why:r.a.createElement(s.Trans,{id:"blm.sharpcast.suggestions.dropped-sharpcasts.why",values:{0:this._droppedSharpcasts}})})),this.suggestions.add(new l.c({icon:o.b.SCATHE.icon,content:r.a.createElement(s.Trans,{id:"blm.sharpcast.suggestions.sharpcasted-scathes.content",components:[r.a.createElement(n.d,Ut({},w.b.SHARPCAST)),r.a.createElement(n.a,Ut({},o.b.SCATHE))]}),tiers:{1:l.a.MINOR,4:l.a.MEDIUM,6:l.a.MAJOR},value:this._sharpedScathes,why:r.a.createElement(s.Trans,{id:"blm.sharpcast.suggestions.sharpcasted-scathes.why",values:{0:this._sharpedScathes},components:[r.a.createElement(n.a,Ut({},o.b.SCATHE))]})}))}}xt.handle="sharpcast",xt.dependencies=["timeline","procs","suggestions"];e.default=[f,k,x,gt,ft,Tt,kt,Nt,xt]}}]);
//# sourceMappingURL=jobs-blm.77db0530.js.map